{"version":3,"sources":["constants.js","XGrid.js","Toolbar.js","WordList.js","helpers.js","KeyPressHandler.js","Clues.js","Print.js","NewPuzzleForm.js","RebusForm.js","MenuActions.js","reducers/grid.js","reducers/motion.js","App.js","serviceWorker.js","index.js"],"names":["DIRECTION_ACROSS","DIRECTION_DOWN","isDirectionAcross","v","isBlockedSquare","UNDO_ACTION","REDO_ACTION","UPDATE_WORD_TO_CLUE","UPDATE_GRID","SET_CURRENT_WORD","SET_SELECTED_SQUARE","SET_CLUE_FOCUS","Grid","grid","selected","currentWord","hideAnswers","onClick","size","rows","cols","gridItems","Array","keys","map","i","row","Math","floor","column","val","classNames","spanClassNames","push","coordinates","some","circles","darkens","cn","join","scn","style","fontSize","length","key","className","gridnums","gridTemplateColumns","gridTemplateRows","useStyles","makeStyles","theme","title","backgroundColor","list","width","formatKey","toUpperCase","mod","test","navigator","platform","replace","MenuSection","items","classes","React","useState","anchorEl","setAnchorEl","handleClose","Button","event","currentTarget","Menu","keepMounted","open","Boolean","onClose","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","MenuListProps","item","MenuItem","cb","action","e","dense","ListItemText","primary","label","ListItemSecondaryAction","FileMenu","actions","handleSavePuzzle","handleImportPuzzle","handleCreateNewPuzzle","EditMenu","handleUndo","handleRedo","InsertMenu","handleInsertRebus","handleInsertBlockedSquare","Toolbar","props","AppBar","position","WORDLIST","memo","words","setWordsState","filtered","setFiltered","debouncedFilter","useCallback","debounce","query","filter","w","match","useEffect","fetch","process","then","resp","text","split","l","startsWith","setWords","RegExp","word","List","slice","ListItem","button","coord2dTo1d","col","valFrom2d","Movement","right","setSelected","min","left","max","up","down","height","moveForward","direction","moveBack","this","KeyPressHandler","setRotationalSymettry","handleBackspace","movement","updateGrid","old","oneD","handleLetter","k","shiftKey","handleCircle","handleDarken","handleSpace","setCurrentWord","Object","assign","handleLeft","handleRight","handleUp","handleDown","cloneDeep","MOVE_UP","MOVE_LEFT","MOVE_RIGHT","MOVE_DOWN","ENTER_LETTER","BACKSPACE","SPACE","noOutline","outline","KeyPressHandlerComponent","hasFocus","setGridFocus","extraActions","kph","keyPressHandler","keyMap","handlers","forEach","handleFocus","_hasFocus","mousetrap","bind","unbind","ref","forwardRef","onFocus","onBlur","tabIndex","children","focused","decode","input","DOMParser","parseFromString","documentElement","textContent","Clue","clue","dir","clueNum","trim","clueText","disabled","error","focus","clsx","TextField","defaultValue","type","margin","variant","fullWidth","InputLabelProps","InputProps","onClueFocus","onClueChanged","handleUpdateWord","target","value","count","d","toLowerCase","clues","mapClues","answers","across","totalCount","container","spacing","xs","Typography","PrintView","liStyle","listStyleType","mapClue","marginRight","marginTop","marginLeft","float","columnCount","padding","textField","NewPuzzleForm","onSave","setOpen","values","setValues","save","handleChange","Dialog","DialogTitle","DialogContent","DialogContentText","onChange","shrink","inputProps","DialogActions","color","RebusForm","onSavePuzzle","onImportPuzzle","onCreateNewPuzzle","onUndo","onRedo","onRebus","onCircle","onDarken","openNewForm","setOpenNewForm","openRebusForm","setOpenRebusForm","loadPuzzleRef","useRef","current","click","useImperativeHandle","handleInsertCircledLetter","handleDarkenCell","Fragment","display","MAX_HISTORY","calcNumbersAndAnswers","wordToClue","out","r","num","j","isNewDown","isNewAcross","start","reduceGridState","state","past","history","undo","nextState","previous","newPast","redo","reduceUndo","future","next","newFuture","reduceRedo","payload","reduceUpdateWordToClue","reduceUpdateGrid","Error","currentWordInitialState","reduceMotionState","nextSelected","nextCurrentWord","setSelectedSquare","setClueFocus","root","flexGrow","paddingLeft","paddingRight","paddingTop","paper","scroll","overflow","maxHeight","TabPanel","index","makePuzzle","g","author","editor","copyright","publisher","date","parseWordToClue","newWordToClue","parse","reduce","acc","ww","resetGridState","JSON","localStorage","getItem","initialGridState","gridRef","createRef","ReactiveGrid","setWidth","handleResize","clientWidth","window","addEventListener","removeEventListener","hotKeyRef","App","useTheme","isPrint","setIsPrint","tabValue","handleTabChanged","useReducer","motionState","dispatchMotionStateUpdate","gridState","dispatchGridStateUpdate","menuActionsRef","updateWordToClue","setItem","stringify","nextCw","valFor","x","coordinatesFor","isNotEnd","end","calcCurrentWord","handleClueFocus","handleClueChanged","handleWordListClicked","gridCopy","coord","clsGridPaper","clsScrollPaper","menuActionsComponent","blob","Blob","saveAs","reader","FileReader","onload","result","newGrid","readAsText","files","letter","circled","darken","matchMedia","addListener","matches","onbeforeprint","onafterprint","separateGrid","useMediaQuery","breakpoints","tabs","Paper","gridComponent","_gridComponent","renderedTabs","Tabs","nv","t","Tab","Container","lg","location","hostname","ReactDOM","render","document","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.6215a923.chunk.js","sourcesContent":["\nexport const DIRECTION_ACROSS = \"ACROSS\"\nexport const DIRECTION_DOWN = \"DOWN\"\nexport const isDirectionAcross = (v) => v === DIRECTION_ACROSS\n\n\nexport const BLOCKED_SQUARE = '.'\nexport const isBlockedSquare = (v) => v === BLOCKED_SQUARE\n\nexport const UNDO_ACTION = \"UNDO\"\nexport const REDO_ACTION = \"REDO\"\nexport const UPDATE_WORD_TO_CLUE = \"UPDATE_WORD_TO_CLUE\"\nexport const UPDATE_GRID = \"UPDATE_GRID\"\n\nexport const SET_CURRENT_WORD = \"SET_CURRENT_WORD\"\nexport const SET_SELECTED_SQUARE = \"SET_SELECTED_SQUARE\"\nexport const SET_CLUE_FOCUS = \"SET_CLUE_FOCUS\"\n\n","import React from 'react';\nimport './XGrid.css';\nimport { isBlockedSquare }  from './constants';\n\nexport default function Grid({grid, selected, currentWord, hideAnswers, onClick}) {\n  const {rows, cols} = grid.size\n  // go from 0 -> width*height and map to a block in the view\n  const gridItems = [...Array(rows*cols).keys()]\n      .map(i => {\n        const row = Math.floor(i / cols)\n        const column = Math.floor(i % cols)\n        const val =  grid.grid[i]\n        const isSelected = selected && selected.row === row && selected.column === column\n        let classNames = [\"Grid-item\"]\n        let spanClassNames = []\n        if(isSelected) {\n          classNames.push(\"Grid-item-selected\")\n        } else if (isBlockedSquare(val)) {\n          classNames.push(\"Grid-item-blocked\")\n        } else if (currentWord && currentWord.coordinates.some(i => i[0] === row && i[1] === column)) {\n          classNames.push(\"Grid-item-highlight\")\n        }\n        if (!!grid.circles[i]) {\n          spanClassNames.push(\"Grid-item-circled\")\n        }\n        if (typeof grid.darkens !== \"undefined\" && !!grid.darkens[i]) {\n          classNames.push(\"Grid-item-darkened\")\n        }\n        const cn = classNames.join(\" \")\n        const scn = spanClassNames.join(\" \")\n        const style = {\n          fontSize: `${(1/(val.length))*1.1}em`\n        }\n\n        return (\n          <div key={i} className={cn} onClick={() => onClick({row, column})}>\n            <span className=\"Grid-number\">{grid.gridnums[i] > 0 ? grid.gridnums[i] : ''}</span>\n            <span className={scn} style={style}>{hideAnswers ? ' ' : val}</span>\n          </div>\n        )\n      })\n\n  return (\n    <div\n      style={{\n        gridTemplateColumns: `repeat(${cols}, 1fr)`,\n        gridTemplateRows: `repeat(${rows}, 1fr)`,\n      }}\n      className=\"Grid-container\"\n    >\n      {gridItems}\n    </div>\n  )\n}\n","import React from 'react';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport AppBar from '@material-ui/core/AppBar';\nimport MuiToolbar from '@material-ui/core/Toolbar';\nimport Button from '@material-ui/core/Button';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\n\nconst useStyles = makeStyles(theme => ({\n  title: {\n    backgroundColor: 'rgba(255,255,255,1)'\n  },\n  list: {\n    width: 200, //not sure why this is needed hack for now\n  }\n}));\n\nconst formatKey = (key) => {\n  if (!key) { return key }\n\n  key = key.toUpperCase()\n  const mod = /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? '⌘' : 'Ctrl'\n  key = key.replace('MOD', mod)\n  key = key.replace('SHIFT', '⇧')\n  if(key.length === 3) {\n    key = key.replace('+', '')\n  }\n  return key\n}\n\nfunction MenuSection({title, items}) {\n  const classes = useStyles()\n  const [anchorEl, setAnchorEl] = React.useState(null);\n\n  const handleClick = event => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  };\n\n  const handleCloseWithCb = cb => e => {\n    cb()\n    handleClose(e)\n  };\n\n\n  return (\n    <div>\n      <Button size=\"small\" onClick={handleClick} >\n        {title}\n      </Button>\n      <Menu\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}\n        getContentAnchorEl={null}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left'}}\n        transformOrigin={{ vertical: 'top', horizontal: 'left'}}\n        MenuListProps={{className: classes.list}}\n      >\n        {items.map((item, i) => (\n          <MenuItem key={i} onClick={handleCloseWithCb(item.action)} dense>\n            <ListItemText primary={item.label} />\n            <ListItemSecondaryAction>{formatKey(item.key)}</ListItemSecondaryAction>\n          </MenuItem>\n        ))}\n      </Menu>\n    </div>\n   )\n}\n\nfunction FileMenu({\n  actions: {\n    handleSavePuzzle,\n    handleImportPuzzle,\n    handleCreateNewPuzzle\n  }\n}) {\n  const items = [\n      {\n        label: \"Save Puzzle\",\n        ...handleSavePuzzle,\n      },\n      {\n        label: \"Load Puzzle\",\n        ...handleImportPuzzle,\n      },\n      {\n        label: \"New Puzzle\",\n        ...handleCreateNewPuzzle,\n      }\n  ]\n\n  return <MenuSection title=\"File\" items={items} />\n}\n\nfunction EditMenu({\n  actions: {\n    handleUndo,\n    handleRedo\n  }\n}) {\n  const items = [\n      {\n        label: \"Undo\",\n        ...handleUndo,\n      },\n      {\n        label: \"Redo\",\n        ...handleRedo\n      },\n  ]\n\n  return <MenuSection title=\"Edit\" items={items} />\n}\n\nfunction InsertMenu({\n  actions: {\n    handleInsertRebus,\n    handleInsertBlockedSquare,\n  }\n}) {\n  const items = [\n      {\n        label: \"Rebus\",\n        ...handleInsertRebus,\n      },\n      {\n        label: \"Blocked Square\",\n        ...handleInsertBlockedSquare,\n      },\n  ]\n\n  return <MenuSection title=\"Insert\" items={items} />\n}\n\n\nexport default function Toolbar(props) {\n  const classes = useStyles()\n\n  if(!props.actions) {\n    return null\n  }\n\n  return (\n    <AppBar position=\"static\">\n     <MuiToolbar className={classes.title}>\n        <FileMenu {...props}/>\n        <EditMenu {...props}/>\n        <InsertMenu {...props}/>\n     </MuiToolbar>\n    </AppBar>\n  )\n}\n","import React, { memo, useState, useEffect, useCallback } from 'react';\n\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\n\nimport {debounce} from 'lodash';\n\nlet WORDLIST = null\n\nconst WordList = ({currentWord, onClick}) => {\n  const [words, setWordsState] = useState(WORDLIST || [])\n  const [filtered, setFiltered] = useState([])\n\n  const setWords = (words) => {\n    //cache wordlist incase component unmounts\n    WORDLIST = words\n    setWordsState(words)\n  }\n\n  const debouncedFilter = useCallback(debounce( query => {\n    setFiltered(words.filter(w => w.match(query)))\n  }, 300), [words])\n\n  useEffect(() => {\n    fetch(`${process.env.PUBLIC_URL}/wordlist/wordlist.txt`)\n      .then(resp => resp.text())\n      .then(text =>\n          text.split(\"\\n\")\n            .filter(l => !l.startsWith(\"#\")))\n      .then(w => setWords(w))\n  }, [])\n\n  useEffect(() => {\n    debouncedFilter(new RegExp(\"^\"+currentWord.word+\"$\", \"i\"))\n  }, [words, currentWord.word, debouncedFilter])\n\n  const max = 100\n\n  return <div>\n    Words: {filtered.length > max ? `showing ${max}/` : ''}{filtered.length}\n    <List dense>\n      {filtered.slice(0,max).map(w =>\n          <ListItem\n            button\n            onClick={() => onClick(w)}\n            key={w}>\n            {w}\n          </ListItem>\n       )}\n    </List>\n  </div>\n}\n\nexport default memo(WordList)\n","\nexport const coord2dTo1d = (grid, row, col) => (grid.size.cols*row)+col\nexport const valFrom2d = (grid, row, col) => grid.grid[coord2dTo1d(grid, row, col)]\n","import React, { useEffect, useState } from 'react';\nimport {\n  isDirectionAcross,\n  isBlockedSquare,\n  DIRECTION_ACROSS,\n  DIRECTION_DOWN,\n  BLOCKED_SQUARE,\n  UNDO_ACTION,\n  REDO_ACTION\n}  from './constants';\nimport {\ncoord2dTo1d,\nvalFrom2d\n} from './helpers';\n\nimport mousetrap from 'mousetrap'\n\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport {cloneDeep} from 'lodash';\n\n\nclass Movement {\n  constructor(props) {\n    const {selected, width, height, currentWord, setSelected} = props\n    this.width = width\n    this.height = height\n    this.selected = selected\n    this.setSelected = setSelected\n    this.currentWord = currentWord\n  }\n\n  right = () => {\n    this.setSelected({\n      row: this.selected.row,\n      column: Math.min(this.width-1, this.selected.column+1)\n    })\n  }\n\n  left = () => {\n    this.setSelected({\n      row: this.selected.row,\n      column: Math.max(0, this.selected.column-1)\n    })\n  }\n  up = () => {\n    this.setSelected({\n      row: Math.max(0, this.selected.row-1),\n      column: this.selected.column\n    })\n  }\n\n  down = () => {\n    this.setSelected({\n      row: Math.min(this.height-1, this.selected.row+1),\n      column: this.selected.column\n    })\n  }\n\n  moveForward = () => {\n    if (isDirectionAcross(this.currentWord.direction)) {\n      this.right()\n    } else {\n      this.down()\n    }\n  }\n  moveBack = () => {\n    if (isDirectionAcross(this.currentWord.direction)) {\n      this.left()\n    } else {\n      this.up()\n    }\n  }\n}\n\nexport class KeyPressHandler {\n  constructor(props) {\n    this.selected = props.selected\n    this.setSelected = props.setSelected\n    this.currentWord = props.currentWord\n    this.setCurrentWord = props.setCurrentWord\n    this.grid = cloneDeep(props.grid)\n    this.updateGrid = props.updateGrid\n    this.rows = props.grid.size.rows\n    this.cols = props.grid.size.cols\n    this.movement = new Movement({\n      width: props.grid.size.cols,\n      height: props.grid.size.rows,\n      setSelected: props.setSelected,\n      currentWord: props.currentWord,\n      selected: props.selected\n    })\n  }\n\n  setRotationalSymettry = (v) => {\n    this.grid.grid[coord2dTo1d(this.grid, this.rows - this.selected.row - 1, this.cols - this.selected.column - 1)] = v\n  }\n\n  handleBackspace = (e) => {\n    const {grid, selected, movement, updateGrid} = this\n\n    const old = valFrom2d(grid, selected.row, selected.column)\n\n    if (isBlockedSquare(old)) {\n      this.setRotationalSymettry('')\n    }\n\n    let oneD = coord2dTo1d(grid, selected.row, selected.column)\n    grid.grid[oneD] = ''\n    grid.circles[oneD] = 0\n\n    movement.moveBack()\n    updateGrid(grid)\n  }\n\n  // This function might get called from rebus without a real event\n  // if there is no \"key\" prop then assume the event is the letter\n  handleLetter = (e) => {\n    let k;\n    if(e.key) {\n      k = e.key.toUpperCase()\n    } else {\n      k = e.toUpperCase()\n    }\n    const {grid, selected, movement, updateGrid} = this\n\n    if(!selected) {\n      return\n    }\n\n    if(k === BLOCKED_SQUARE) {\n      grid.grid[coord2dTo1d(grid, selected.row, selected.column)] = k\n      this.setRotationalSymettry(k)\n      movement.moveForward()\n      updateGrid(grid)\n    } else if (e.shiftKey) {\n      grid.grid[coord2dTo1d(grid, selected.row, selected.column)] += k\n      updateGrid(grid)\n    } else {\n      const old = valFrom2d(grid, selected.row, selected.column)\n      if (old === k) {\n        // don't issue grid update if its the same letter\n        movement.moveForward()\n        return\n      }\n      if (isBlockedSquare(old)) {\n        this.setRotationalSymettry('')\n      }\n      grid.grid[coord2dTo1d(grid, selected.row, selected.column)] = k\n      movement.moveForward()\n      updateGrid(grid)\n    }\n  }\n\n  handleCircle = (k) => {\n    const {grid, selected, movement, updateGrid} = this\n\n    if(!selected) {\n      return\n    }\n\n    grid.circles[coord2dTo1d(grid, selected.row, selected.column)] = k\n    movement.moveForward()\n    updateGrid(grid)\n  }\n\n  handleDarken = (k) => {\n    const {grid, selected, movement, updateGrid} = this\n\n    if(!selected) {\n      return\n    }\n\n    grid.darkens[coord2dTo1d(grid, selected.row, selected.column)] = k\n    movement.moveForward()\n    updateGrid(grid)\n  }\n\n  handleSpace = (e) => {\n    const {setCurrentWord, currentWord} = this\n    setCurrentWord(Object.assign({}, currentWord, {\n      direction: isDirectionAcross(currentWord.direction) ? DIRECTION_DOWN : DIRECTION_ACROSS\n    }))\n  }\n\n  handleLeft = () => {\n    this.movement.left()\n  }\n\n  handleRight = () => {\n    this.movement.right()\n  }\n\n  handleUp = () => {\n    this.movement.up()\n  }\n\n  handleDown = () => {\n    this.movement.down()\n  }\n\n}\n\nconst MOVE_UP = 'MOVE_UP'\nconst MOVE_LEFT = 'MOVE_LEFT'\nconst MOVE_RIGHT = 'MOVE_RIGHT'\nconst MOVE_DOWN = 'MOVE_DOWN'\nconst ENTER_LETTER = 'ENTER_LETTER'\nconst BACKSPACE = 'BACKSPACE'\nconst SPACE = 'SPACE'\nconst UNDO = 'UNDO'\nconst REDO = 'REDO'\n\n\nconst useStyles = makeStyles(theme => ({\n noOutline: {\n    \"&:focus\": {\n      outline: 0,\n    }\n }\n}))\n\n\nexport default function KeyPressHandlerComponent(props) {\n  const classes = useStyles()\n  const [hasFocus, setGridFocus] = useState(false)\n  const {extraActions, keyPressHandler: kph} = props\n\n  let keyMap = {\n    [MOVE_UP]: 'up',\n    [MOVE_DOWN]: 'down',\n    [MOVE_LEFT]: 'left',\n    [MOVE_RIGHT]: 'right',\n    [ENTER_LETTER]: \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\".split(''),\n    [BACKSPACE]: ['del', 'backspace'],\n    [SPACE]: 'space',\n  }\n\n  let handlers = {\n    [MOVE_UP]: kph.handleUp,\n    [MOVE_DOWN]: kph.handleDown,\n    [MOVE_LEFT]: kph.handleLeft,\n    [MOVE_RIGHT]: kph.handleRight,\n    [ENTER_LETTER]: kph.handleLetter,\n    [BACKSPACE]: kph.handleBackspace,\n    [SPACE]: kph.handleSpace,\n  }\n\n  if (extraActions) {\n    Object.keys(extraActions).forEach(k => {\n      keyMap[k] = extraActions[k].key\n      handlers[k] = (e) => {\n        extraActions[k].action()\n        // prevent browser form intercepting\n        return false\n      }\n    })\n  }\n\n  const handleFocus = _hasFocus => e => {\n    setGridFocus(_hasFocus)\n  }\n\n  const withFocus = cb => (e) => hasFocus && cb(e)\n\n  useEffect(() => {\n    Object.keys(keyMap).forEach((k) => {\n      mousetrap.bind(keyMap[k], withFocus(handlers[k]))\n    })\n    return () => {\n      Object.keys(keyMap).forEach((k) => {\n        mousetrap.unbind(keyMap[k])\n      })\n    }\n  })\n\n\n  return (\n    <div ref={props.forwardRef} className={classes.noOutline} onFocus={handleFocus(true)} onBlur={handleFocus(false)} tabIndex=\"-1\">\n      {props.children}\n    </div>\n  )\n}\n","import React, { memo } from 'react';\nimport clsx from 'clsx';\n\nimport {\n  DIRECTION_ACROSS,\n  DIRECTION_DOWN,\n}  from './constants';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport TextField from '@material-ui/core/TextField';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\n\nconst useStyles = makeStyles(theme => ({\n  // pseudo class to apply when we want to style focus\n  // withouth applying real focus\n  focused: {}\n}));\n\nexport function decode(input)\n{\n  var doc = new DOMParser().parseFromString(input, \"text/html\");\n  return doc.documentElement.textContent;\n}\n\nfunction Clue({word, clue, dir, currentWord, onClick, onBlur}) {\n  // how do i make classes generate the right name 'Mui-focused'\n  const classes = useStyles()\n  const clueNum = +clue.match(/^ *[0-9]+/)[0].trim()\n  const clueText = decode(clue.replace(/^ *[0-9]*\\. */, ''))\n  const disabled = word.match(\"_\")\n  const error = !disabled && !clueText.length\n  const focus = currentWord.clueNum === clueNum && currentWord.direction === dir\n  const className = clsx({'Mui-focused': focus})\n  return (\n      <TextField\n        label={`${clueNum}: ${word}`}\n        defaultValue={clueText}\n        type=\"text\"\n        margin=\"dense\"\n        variant=\"outlined\"\n        fullWidth\n        onClick={onClick(dir, clueNum)}\n        onBlur={onBlur(dir, word)}\n        disabled={disabled}\n        error={error}\n        InputLabelProps={{className}}\n        InputProps={{className}}\n      />\n  )\n}\n\nexport default memo(function Clues({grid, currentWord, onClueFocus, onClueChanged}) {\n    const handleFocus = (dir, clueNum) => (e) => {\n      onClueFocus(dir, clueNum)\n    }\n\n    const handleUpdateWord = (dir, word) => e => {\n      onClueChanged(dir, word, e.target.value)\n    }\n\n    const count = (dir) => {\n        const d = dir.toLowerCase()\n        return grid.clues[d].length\n    }\n\n    const mapClues = (dir) => {\n      const d = dir.toLowerCase()\n      return grid.clues[d].map((clue, i) => {\n        const word = grid.answers[d][i]\n        return <Clue\n          key={`${d}-${i}-${word}`}\n          word={word}\n          clue={clue}\n          dir={dir}\n          currentWord={currentWord}\n            onClick={handleFocus}\n            onBlur={handleUpdateWord}\n        />\n      })\n    }\n\n    const across = mapClues(DIRECTION_ACROSS)\n    const down = mapClues(DIRECTION_DOWN)\n    const totalCount = count(DIRECTION_ACROSS) + count(DIRECTION_DOWN)\n    return (\n      <div>\n        <Grid container spacing={1}>\n          <Grid item xs>\n            <Typography>Across</Typography>\n              {across}\n          </Grid>\n          <Grid item xs>\n            <Typography>Down</Typography>\n              {down}\n          </Grid>\n        </Grid>\n        <Typography>Total: {totalCount}</Typography>\n      </div>\n    )\n  })\n","import React from 'react';\n\nimport XGrid from './XGrid'\nimport {decode} from './Clues'\n\n\nexport default function PrintView({grid}) {\n  const ulStyle = {\n    width: 'calc(50vw - 40px)',\n    columnCount: 2,\n    margin: 0,\n    padding: 0,\n  }\n  const liStyle = {\n    margin: 0,\n    listStyleType: 'none',\n  }\n\n  const containerStyle = {\n    marginTop: 40,\n    marginRight: 20,\n    marginLeft: 20,\n    height: \"calc(100vh - 40px)\",\n  }\n\n  const gridStyle = {\n    float: 'right',\n    width: '50vmin',\n    height: '50vmin'\n  }\n\n  const mapClue = (v)  => {\n    const clueNum = +v.match(/^ *[0-9]+/)[0].trim()\n    const clueText = decode(v.replace(/^ *[0-9]*\\. */, ''))\n    return (\n      <li style={liStyle} key={v}>\n        <b style={{marginRight: 2}}>{clueNum}</b>\n        {clueText}\n      </li>\n    )\n  }\n\n  /*\n      */\n  return (\n    <div style={containerStyle}>\n      <div style={gridStyle}>\n        <XGrid grid={grid} hideAnswers={true}/>\n      </div>\n      <ul style={ulStyle}>\n        <li style={liStyle}><b>ACROSS</b></li>\n        {grid.clues.across.map(mapClue)}\n        <li style={liStyle}><b>DOWN</b></li>\n        {grid.clues.down.map(mapClue)}\n      </ul>\n    </div>\n  )\n}\n","import React from 'react';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport TextField from '@material-ui/core/TextField';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\nimport AddIcon from '@material-ui/icons/Add';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nconst useStyles = makeStyles(theme => ({\n  textField: {\n      marginLeft: theme.spacing(1),\n      marginRight: theme.spacing(1),\n    },\n}));\n\nexport default function NewPuzzleForm({onSave, open, setOpen}) {\n  const classes = useStyles();\n  const [values, setValues] = React.useState({rows: 15, cols: 15})\n\n  const handleClose = (save) => () => {\n    setOpen(false);\n\n    if(save) {\n      onSave(values)\n    }\n\n  };\n\n  const handleChange = (dir) => (event) => {\n    setValues(Object.assign({}, values, {[dir]: +event.target.value || ''}))\n  }\n\n  return (\n      <Dialog open={open} onClose={handleClose(false)}>\n        <DialogTitle>Create New Puzzle</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Create a new puzzle. Warning! This will destroy the current puzzle. Make sure to save first!\n          </DialogContentText>\n          <TextField\n            label=\"Rows\"\n            value={values.rows}\n            onChange={handleChange('rows')}\n            className={classes.textField}\n            type=\"number\"\n            InputLabelProps={{\n              shrink: true,\n            }}\n            margin=\"normal\"\n            variant=\"outlined\"\n            inputProps={{\n              min: 1,\n              max: 100\n            }}\n          />\n          <TextField\n            label=\"Columns\"\n            value={values.cols}\n            onChange={handleChange('cols')}\n            className={classes.textField}\n            type=\"number\"\n            InputLabelProps={{\n              shrink: true,\n            }}\n            margin=\"normal\"\n            variant=\"outlined\"\n            inputProps={{\n              min: 1,\n              max: 100\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleClose(false)} color=\"primary\">\n            Cancel\n          </Button>\n          <Button onClick={handleClose(true)} color=\"primary\">\n            Create\n          </Button>\n        </DialogActions>\n      </Dialog>\n  );\n}\n","import React from 'react';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport TextField from '@material-ui/core/TextField';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\n\nconst useStyles = makeStyles(theme => ({\n  textField: {\n      marginLeft: theme.spacing(1),\n      marginRight: theme.spacing(1),\n    },\n}));\n\nexport default function RebusForm({onSave, open, setOpen}) {\n  const classes = useStyles();\n  const [values, setValues] = React.useState('')\n\n  const handleClose = (save) => () => {\n    setOpen(false);\n\n    if(save) {\n      onSave(values)\n    }\n\n  };\n\n  const handleChange = (event) => {\n    setValues(event.target.value.toUpperCase())\n  }\n\n  return (\n      <Dialog open={open} onClose={handleClose(false)}>\n        <DialogTitle>Insert Rebus</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Add a rebus\n          </DialogContentText>\n          <TextField\n            label=\"Text\"\n            value={values}\n            onChange={handleChange}\n            className={classes.textField}\n            type=\"text\"\n            InputLabelProps={{\n              shrink: true,\n            }}\n            margin=\"normal\"\n            variant=\"outlined\"\n            inputProps={{\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleClose(false)} color=\"primary\">\n            Cancel\n          </Button>\n          <Button onClick={handleClose(true)} color=\"primary\">\n            Save\n          </Button>\n        </DialogActions>\n      </Dialog>\n  );\n}\n","import React, {forwardRef, useImperativeHandle} from 'react';\nimport NewPuzzleForm from './NewPuzzleForm'\nimport RebusForm from './RebusForm'\n\nimport {BLOCKED_SQUARE} from './constants'\n\n// A hack to get a bunch of dom state into the UI\n// and manage button clicks for menu Action items and hotkeys\nexport default forwardRef(function MenuActions(props, ref) {\n  const {\n    onSavePuzzle,\n    onImportPuzzle,\n    onCreateNewPuzzle,\n    onUndo,\n    onRedo,\n    onRebus,\n    onCircle,\n    onDarken,\n  } = props\n\n  const [openNewForm, setOpenNewForm] = React.useState(false);\n  const [openRebusForm, setOpenRebusForm] = React.useState(false);\n  const loadPuzzleRef = React.useRef()\n\n  const handleImportPuzzle = () => {\n    loadPuzzleRef.current.click()\n  }\n  const handleCreateNewPuzzle = () => {\n    setOpenNewForm(true)\n  }\n  const handleInsertRebus = () => {\n    setOpenRebusForm(true)\n  }\n\n  useImperativeHandle(ref, () => ({\n    handleSavePuzzle: {\n      key: 'mod+s',\n      action: onSavePuzzle,\n    },\n    handleImportPuzzle: {\n      key: 'mod+o',\n      action: handleImportPuzzle,\n    },\n    handleCreateNewPuzzle: {\n      key: 'mod+u',\n      action: handleCreateNewPuzzle\n    },\n    handleUndo: {\n      key: 'mod+z',\n      action: onUndo\n    },\n    handleRedo: {\n      key: 'mod+shift+z',\n      action: onRedo\n    },\n    handleInsertRebus: {\n      key: 'mod+i',\n      action: handleInsertRebus\n    },\n    handleInsertBlockedSquare: {\n      key: BLOCKED_SQUARE,\n      action: () => onRebus(BLOCKED_SQUARE)\n    },\n    handleInsertCircledLetter: {\n      key: 'mod+c',\n      action: () => onCircle()\n    },\n    handleDarkenCell: {\n      key: 'mod+b',\n      action: () => onDarken()\n    },\n  }))\n\n  return (\n    <React.Fragment>\n      <input\n        ref={loadPuzzleRef}\n        type=\"file\"\n        style={{ display: \"none\" }}\n        onChange={onImportPuzzle}\n      />\n      <NewPuzzleForm\n        open={openNewForm}\n        setOpen={setOpenNewForm}\n        onSave={onCreateNewPuzzle}\n      />\n      <RebusForm\n        open={openRebusForm}\n        setOpen={setOpenRebusForm}\n        onSave={onRebus}\n      />\n    </React.Fragment>\n  )\n})\n","import {\n  isBlockedSquare,\n  UNDO_ACTION,\n  REDO_ACTION,\n  UPDATE_WORD_TO_CLUE,\n  UPDATE_GRID,\n}  from '../constants';\n\nimport { coord2dTo1d, valFrom2d } from '../helpers';\n\nconst MAX_HISTORY = 25\n\nfunction calcNumbersAndAnswers(grid, wordToClue) {\n  const {rows, cols} = grid.size\n  let out = {\n    gridnums: grid.grid.map(r => 0), // clone grid\n    answers: {down: [], across: []},\n    clues: {down: [], across: []}\n  }\n\n  let num = 1;\n  for (let i=0; i<rows; ++i){\n    for (let j=0; j<cols; ++j) {\n      if (isBlockedSquare(valFrom2d(grid, i, j))) continue;\n\n      const isNewDown = (i === 0 || isBlockedSquare(valFrom2d(grid,i-1,j))) && !(i === rows || isBlockedSquare(valFrom2d(grid,i+1,j)))\n      const isNewAcross = (j === 0 || isBlockedSquare(valFrom2d(grid,i,j-1))) && !(j === cols || isBlockedSquare(valFrom2d(grid,i,j+1)))\n      if(isNewAcross || isNewDown) {\n        out.gridnums[coord2dTo1d(grid, i, j)] = num++;\n      }\n\n      if(isNewAcross) {\n        let currentWord = \"\"\n        let start = j;\n        while(!isBlockedSquare(valFrom2d(grid,i,start)) && start < cols) {\n          let w = valFrom2d(grid, i, start)\n          currentWord += w ? w : '_'\n          start++\n        }\n        out.answers.across.push(currentWord)\n        let clue = wordToClue[currentWord] || ''\n        out.clues.across.push(`${num-1}. ${clue}`)\n      }\n\n      if(isNewDown) {\n        let currentWord = \"\"\n        let start = i;\n        while(!isBlockedSquare(valFrom2d(grid,start,j)) && start < rows) {\n          let w = valFrom2d(grid, start, j)\n          currentWord += w ? w : '_'\n          start++\n        }\n        out.answers.down.push(currentWord)\n        let clue = wordToClue[currentWord] || ''\n        out.clues.down.push(`${num-1}. ${clue}`)\n      }\n\n    }\n  }\n\n  return out;\n}\n\nfunction reduceUndo(state, action) {\n  const past = state.history.undo\n\n  if (!past.length) {\n    return state\n  }\n\n  const nextState = {...state}\n  const previous = past[past.length - 1]\n  const newPast = past.slice(0, past.length - 1)\n  nextState.grid = previous\n  nextState.history = {\n    undo: newPast,\n    redo: [state.grid, ...state.history.redo]\n  }\n\n  return nextState\n}\n\nfunction reduceRedo(state, action) {\n  const future = state.history.redo\n\n  if (!future.length) {\n    return state\n  }\n\n  const nextState = {...state}\n  const next = future[0]\n  const newFuture = future.slice(1)\n  nextState.grid = next\n  nextState.history = {\n    undo: [...state.history.undo, state.grid],\n    redo: newFuture\n  }\n\n  return nextState\n}\n\nfunction reduceUpdateWordToClue(state, action) {\n  const wordToClue = {\n    ...state.wordToClue,\n    ...action.payload,\n  }\n\n  const ns = {\n    ...state,\n    grid: {\n      ...state.grid,\n      // Update clues in grid model when the clues change\n      ...calcNumbersAndAnswers(state.grid, wordToClue)\n    },\n    wordToClue\n  }\n  return ns\n}\n\nfunction reduceUpdateGrid(state, action) {\n  const nextState = {...state, ...action.payload}\n  nextState.grid = {...nextState.grid, ...calcNumbersAndAnswers(nextState.grid, nextState.wordToClue)}\n  // since history gets pushed on the the stack slice off the start of the history to keep the size small enough\n  nextState.history.undo = state.history.undo.slice(-MAX_HISTORY)\n  nextState.history.undo.push(state.grid)\n  nextState.history.redo = []\n\n  return nextState\n}\n\nexport function reduceGridState(state, action) {\n  switch(action.type) {\n    case UNDO_ACTION:\n      return reduceUndo(state, action)\n    case REDO_ACTION:\n      return reduceRedo(state, action)\n    case UPDATE_WORD_TO_CLUE:\n      return reduceUpdateWordToClue(state, action)\n    case UPDATE_GRID:\n      return reduceUpdateGrid(state, action)\n    default:\n      throw new Error('Unknown Action Type: ' + action.type)\n  }\n}\n","import {\n  isDirectionAcross,\n  DIRECTION_ACROSS,\n  DIRECTION_DOWN,\n  SET_CURRENT_WORD,\n  SET_SELECTED_SQUARE,\n  SET_CLUE_FOCUS\n}  from '../constants';\n\n\nfunction setCurrentWord(state, action) {\n  return {\n    ...state,\n    currentWord: {\n      ...state.currentWord,\n      ...action.payload\n    }\n  }\n}\n\nfunction setSelectedSquare(state, action) {\n  const {currentWord, selected} = state\n  const nextSelected = action.payload\n  let nextCurrentWord = currentWord\n\n  //swap direction if selected is double clicked\n  if(nextSelected && selected && nextSelected.row === selected.row && nextSelected.column === selected.column) {\n    nextCurrentWord = {\n      ...nextCurrentWord,\n      direction: isDirectionAcross(currentWord.direction) ? DIRECTION_DOWN : DIRECTION_ACROSS\n    }\n  }\n\n  return {\n    ...state,\n    selected: nextSelected,\n    currentWord: nextCurrentWord\n  }\n}\n\nfunction setClueFocus(state, action) {\n  const {direction, selected} = action.payload\n  return {\n    ...state,\n    currentWord: {\n      ...currentWordInitialState(),\n      direction,\n    },\n    selected,\n  }\n}\n\nexport function currentWordInitialState() {\n  return {word: \"\", direction: DIRECTION_ACROSS, coordinates: []}\n}\n\nexport function reduceMotionState(state, action) {\n  switch(action.type) {\n    case SET_CURRENT_WORD:\n      return setCurrentWord(state, action)\n    case SET_SELECTED_SQUARE:\n      return setSelectedSquare(state, action)\n    case SET_CLUE_FOCUS:\n      return setClueFocus(state, action)\n    default:\n      throw new Error('Unknown Action Type: ' + action.type)\n  }\n}\n","import React, { useState, useReducer, useEffect, useCallback, useRef } from 'react';\nimport clsx from 'clsx';\nimport './App.css';\nimport XGrid from './XGrid'\nimport Toolbar from './Toolbar'\nimport WordList from './WordList'\nimport KeyPressHandlerComponent, {KeyPressHandler} from './KeyPressHandler'\nimport Clues from './Clues'\nimport PrintView from './Print'\nimport MenuActions from './MenuActions'\nimport {\n  isDirectionAcross,\n  isBlockedSquare,\n  UNDO_ACTION,\n  REDO_ACTION,\n  UPDATE_WORD_TO_CLUE,\n  UPDATE_GRID,\n  SET_CURRENT_WORD,\n  SET_SELECTED_SQUARE,\n  SET_CLUE_FOCUS,\n} from './constants';\n\nimport { coord2dTo1d, valFrom2d } from './helpers';\nimport { reduceGridState } from './reducers/grid'\nimport { reduceMotionState, currentWordInitialState } from './reducers/motion'\n\n\nimport { saveAs } from 'file-saver';\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport Paper from '@material-ui/core/Paper';\nimport Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\n\nimport {cloneDeep } from 'lodash';\n\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: \"flex\",\n  },\n  title: {\n    flexGrow: 1\n  },\n  container: {\n    paddingLeft: 12,\n    paddingRight: 12,\n    paddingTop: 32,\n  },\n  paper: {\n    padding: 10,\n  },\n  scroll: {\n    overflow: \"scroll\",\n    maxHeight: \"calc(100vh - 180px)\",\n  }\n}));\n\n\n\nfunction TabPanel(props) {\n  const { children, value, index } = props;\n\n  let hidden = value !== index\n\n  if (hidden) {\n    return <div></div>\n  }\n\n  return <div>\n    {children}\n  </div>\n}\n\nfunction calcCurrentWord({direction, grid, selected}) {\n    if (!selected) { return null }\n\n    const valFor = (x) => isDirectionAcross(direction) ? valFrom2d(grid, selected.row, x) : valFrom2d(grid, x, selected.column)\n    const coordinatesFor = (x) => isDirectionAcross(direction) ? [selected.row, x] : [x, selected.column]\n    const isNotEnd = (end) => isDirectionAcross(direction) ? end < grid.size.cols : end < grid.size.rows\n\n    let start = isDirectionAcross(direction) ? selected.column : selected.row;\n    let end = start\n\n    // Find beginning\n    // Then find end of the word\n    // When convert those values into an string and convert blanks to . for word search\n    // also compile list of coordinates for grid highlighting\n    //  finally set the new state\n    while(start>0 && !isBlockedSquare(valFor(start))) start--;\n    while(isNotEnd(end) && !isBlockedSquare(valFor(end))) end++;\n    if (isBlockedSquare(valFor(start))) start++;\n\n    let word = \"\"\n    let coordinates = []\n    const clueNum = grid.gridnums[coord2dTo1d(grid, coordinatesFor(start)[0], coordinatesFor(start)[1])]\n\n    for(let i=start; i<end; ++i) {\n      let v = valFor(i)\n      if (v === \"\") v = \".\";\n      word += v\n      coordinates.push(coordinatesFor(i))\n    }\n\n    return { word, coordinates, clueNum }\n}\n\n// Format specified by https://www.xwordinfo.com/JSON/\nconst makePuzzle = (size) => {\n  let g = {\n    title: \"TODO: NY Times, Thu, Sep 11, 2008\",\n    author: \"TODO: Caleb Madison\",\n    editor: \"TODO: Will Shortz\",\n    copyright: \"TODO: 2008, The New York Times\",\n    publisher: \"TODO: The New York Times\",\n    date: \"TODO: 9/11/2008\",\n    size,\n    // clues should include number as well e.g. \"1. Waxed\"\n    clues: {\n      across: [],\n      down: []\n    }\n  }\n  return Object.assign(g, {\n    // '.' means black, multiple letters valid for rebus\n    grid: [...Array(g.size.rows*g.size.cols).keys()].map(v => \"\"),\n    // 0 means no number\n    gridnums: [...Array(g.size.rows*g.size.cols).keys()].map(v => 0),\n    // 0 means no-circle 1 means circle\n    circles: [...Array(g.size.rows*g.size.cols).keys()].map(v => 0),\n    // 0 means no-gray 1 means gray\n    darkens: [...Array(g.size.rows*g.size.cols).keys()].map(v => 0),\n  })\n}\n\nfunction parseWordToClue(grid) {;\n  const newWordToClue = {}\n  if (grid.answers) {\n    const parse = dir => {\n      grid.answers[dir]\n      .filter(w => !w.match('_'))\n      .reduce((acc, w, i) => {\n        let ww = (grid.clues[dir][i] || '').replace(/^ *[0-9]*\\. */, '')\n        acc[w] = ww\n        return acc\n      }, newWordToClue)\n    }\n\n    parse('down')\n    parse('across')\n  }\n\n  return newWordToClue\n}\n\nfunction resetGridState(g) {\n    const grid = g || JSON.parse(localStorage.getItem(\"grid\")) || makePuzzle({rows: 15, cols: 15})\n    const wordToClue = parseWordToClue(grid)\n    const history = JSON.parse(localStorage.getItem(\"history\")) || {undo: [], redo: []}\n\n    return {grid, wordToClue, history}\n}\n\nconst initialGridState = resetGridState()\n\n\nconst gridRef = React.createRef();\nfunction ReactiveGrid({children}) {\n  let [width, setWidth] = useState(\"100%\")\n\n  const handleResize = () => {\n    gridRef.current && setWidth(gridRef.current.clientWidth)\n  }\n\n  useEffect(() => {\n    // add event listener then call function on first render to ensure size is correct\n    window.addEventListener('resize', handleResize)\n    handleResize()\n    return () => {\n      window.removeEventListener('resize', handleResize)\n    }\n  }, [])\n\n  return (\n    <div ref={gridRef} style={{width: width, height: width}}>\n      {children}\n    </div>\n  )\n}\n\nconst hotKeyRef = React.createRef()\n\n\nfunction App() {\n  const classes = useStyles()\n  const theme = useTheme()\n  const [isPrint, setIsPrint] = useState(false)\n  const [tabValue, handleTabChanged] = useState(0)\n  const [motionState, dispatchMotionStateUpdate] = useReducer(reduceMotionState, {selected: null, currentWord: currentWordInitialState()})\n  const [gridState, dispatchGridStateUpdate] = useReducer(reduceGridState, initialGridState)\n  const menuActionsRef = useRef()\n  const {grid, history} = gridState\n\n  const {selected, currentWord} = motionState\n\n\n  const updateGridState = (nextState) => {\n    if (nextState === UNDO_ACTION || nextState === REDO_ACTION) {\n      dispatchGridStateUpdate({type: nextState})\n    } else {\n      dispatchGridStateUpdate({\n        type: UPDATE_GRID,\n        payload: {grid: nextState}\n      })\n    }\n  }\n\n  const updateWordToClue = useCallback((word, clue) => {\n    dispatchGridStateUpdate({\n      type: UPDATE_WORD_TO_CLUE,\n      payload: {\n        [word]: clue\n      }\n    })\n  }, [])\n\n  const setCurrentWord = useCallback((currentWord) => {\n    dispatchMotionStateUpdate({\n      type: SET_CURRENT_WORD,\n      payload: currentWord\n    })\n  }, [])\n\n  const setSelected = useCallback((nextSelected) => {\n    dispatchMotionStateUpdate({\n      type: SET_SELECTED_SQUARE,\n      payload: nextSelected\n    })\n  }, [])\n\n  useEffect(() => {\n    localStorage.setItem(\"grid\", JSON.stringify(grid))\n    localStorage.setItem(\"history\", JSON.stringify(history))\n  }, [grid, history])\n\n  useEffect(() => {\n    const nextCw = calcCurrentWord({selected, direction: currentWord.direction, grid})\n    nextCw && setCurrentWord(nextCw)\n  }, [setCurrentWord, selected, grid, currentWord.direction])\n\n\n\n  const handleClueFocus = useCallback((direction, clueNum) => {\n    let selected = {}\n    for(let i=0; i<grid.gridnums.length; ++i) {\n      if(grid.gridnums[i] == clueNum) {\n        const row = Math.floor(i / grid.size.cols)\n        const column = Math.floor(i % grid.size.cols)\n        selected = {\n          row, column\n        }\n        break;\n      }\n    }\n    dispatchMotionStateUpdate({\n      type: SET_CLUE_FOCUS,\n      payload: {\n        direction,\n        selected\n      }\n    })\n  }, [grid])\n\n  const handleClueChanged = useCallback((direction, word, clue) => {\n    updateWordToClue(word, clue)\n  }, [updateWordToClue])\n\n  const handleSavePuzzle = () => {\n    var blob = new Blob([JSON.stringify(grid)], {type: \"text/plain;charset=utf-8\"});\n    saveAs(blob, \"puzzle.json\")\n  }\n\n  // TODO handle failure and validate puzzle format\n  const handleImportPuzzle = (e) => {\n    let input = e.target;\n    if (!input.value) {\n      return;\n    }\n\n    let reader = new FileReader();\n    reader.onload = function(){\n      let text = reader.result;\n      const newGrid = JSON.parse(text)\n      dispatchGridStateUpdate({\n        type: UPDATE_GRID,\n        payload: {\n          grid: newGrid,\n          wordToClue: parseWordToClue(newGrid)\n        }\n      })\n    };\n\n    reader.readAsText(input.files[0]);\n    input.value = '';\n  }\n\n  const handleCreateNewPuzzle = (size) => {\n    dispatchGridStateUpdate({\n      type: UPDATE_GRID,\n      payload: resetGridState(makePuzzle(size))\n    })\n    setSelected()\n  }\n\n  const handleWordListClicked = useCallback(word => {\n    const gridCopy = cloneDeep(grid)\n\n    currentWord.coordinates.forEach((coord, i) => {\n      gridCopy.grid[coord2dTo1d(grid, coord[0], coord[1])] = word[i]\n    })\n\n    hotKeyRef.current.focus()\n\n    dispatchGridStateUpdate({\n      type: UPDATE_GRID,\n      payload: {grid: gridCopy}\n    })\n  }, [grid, currentWord])\n\n  const handleCircleLogic = () => {\n    let selectedCell = valFrom2d(grid, selected.row, selected.column);\n    if (selectedCell === \"\") {\n    } else {\n      let circled = grid.circles[coord2dTo1d(grid, selected.row, selected.column)];\n      circled = 1 - circled\n      keyPressHandler.handleCircle(circled)\n    }\n  }\n\n  const handleDarkenLogic = () => {\n    if (typeof grid.darkens !== \"undefined\") { // Handle backwards compatibility\n      let darken = grid.darkens[coord2dTo1d(grid, selected.row, selected.column)];\n      darken = 1 - darken\n      keyPressHandler.handleDarken(darken)\n    }\n  }\n\n  const clsGridPaper = clsx(classes.paper)\n  const clsScrollPaper = clsx(classes.paper, classes.scroll)\n\n  const keyPressHandler = new KeyPressHandler({\n    selected,\n    setSelected,\n    setCurrentWord,\n    currentWord,\n    grid,\n    updateGrid: updateGridState,\n  })\n\n  const menuActionsComponent = (\n    <MenuActions\n      ref={menuActionsRef}\n      onSavePuzzle={handleSavePuzzle}\n      onImportPuzzle={handleImportPuzzle}\n      onCreateNewPuzzle={handleCreateNewPuzzle}\n      onUndo={() => dispatchGridStateUpdate({type: UNDO_ACTION})}\n      onRedo={() => dispatchGridStateUpdate({type: REDO_ACTION})}\n      onRebus={(letter) => keyPressHandler.handleLetter(letter)}\n      onCircle={handleCircleLogic}\n      onDarken={handleDarkenLogic}\n    />\n  )\n\n\n  useEffect(() => {\n    const listener = (e) => setIsPrint(e.matches)\n    window.matchMedia(\"print\").addListener(listener)\n    window.onbeforeprint = () => setIsPrint(true)\n    window.onafterprint = () => setIsPrint(false)\n  }, [])\n\n  const separateGrid = useMediaQuery(theme.breakpoints.up('lg'))\n\n  if (isPrint) {\n    return <PrintView grid={grid} />\n  }\n\n  let tabs = [\n    {label: \"Word List\", children: (\n      <Paper className={clsScrollPaper} >\n        <WordList onClick={handleWordListClicked} currentWord={currentWord}/>\n      </Paper>\n    )},\n    {label: \"Clues\", children: (\n      <Paper className={clsScrollPaper} >\n        <Clues currentWord={currentWord} grid={grid} onClueFocus={handleClueFocus} onClueChanged={handleClueChanged}/>\n      </Paper>\n    )},\n  ]\n\n  let gridComponent = null\n\n  const _gridComponent = (\n    <KeyPressHandlerComponent keyPressHandler={keyPressHandler} forwardRef={hotKeyRef} extraActions={menuActionsRef.current}>\n      <Paper className={clsGridPaper} >\n        <ReactiveGrid>\n          <XGrid grid={grid} selected={motionState.selected} currentWord={motionState.currentWord} onClick={setSelected} />\n        </ReactiveGrid>\n      </Paper>\n    </KeyPressHandlerComponent>\n  )\n\n  if (separateGrid) {\n    gridComponent = _gridComponent\n  } else {\n    tabs = [{label: \"Grid\", children: _gridComponent}, ...tabs]\n  }\n\n  const renderedTabs = (\n    <React.Fragment>\n      <Tabs value={tabValue} onChange={(e,nv) => handleTabChanged(nv)}>\n        {tabs.map(t => <Tab key={t.label} label={t.label}/>)}\n      </Tabs>\n      {tabs.map((t,i) => <TabPanel key={t.label} value={tabValue} index={i}>{t.children}</TabPanel>)}\n    </React.Fragment>\n  )\n\n  return (\n    <div className=\"App\">\n      <Toolbar actions={menuActionsRef.current}/>\n      <Container className={classes.container}>\n        <Grid container spacing={2}>\n        { separateGrid && (\n          <Grid item lg={6} >\n            {gridComponent}\n          </Grid>\n        )}\n          <Grid item lg={6}>\n            {renderedTabs}\n          </Grid>\n        </Grid>\n      </Container>\n      {menuActionsComponent}\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}